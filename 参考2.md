#keibaai/data/raw/html ディレクトリのファイル特性に関する総合的な説明

keibaai/data/raw/html ディレクトリには、horse, ped, race, shutuba の 4 つのサブディレクトリが存在し、それぞれ異なる種類の生データが格納されています。これらのディレクトリ内のファイルは、.bin という古い形式と、.html という新しい形式が混在しており、命名規則にもいくつかのパターンが見られます。

1. ファイル形式の混在

- `.bin` ファイル: 主に古いデータで使われているバイナリ形式のファイルです。これらのファイルは、システムの初期段階で収集されたデータである可能性が高いです。
- `.html` ファイル: より新しいデータで使われている HTML 形式のファイルです。これらのファイルには、バージョン情報（取得日時とハッシュ値）が含まれており、データの変更履歴を追跡できるようになっています。

2. 各ディレクトリのファイル命名規則

##### horse ディレクトリ

- 対象: 馬のプロフィールや過去の成績に関するデータ
- `.bin` ファイル: YYYYMMDDNN_type.bin の形式。
  - 例: 2017102294_perf.bin
  - 数字の部分は horse*id に対応し、* の後には perf (成績) や profile (プロフィール) のようなデータの種類を示すタイプが付与されています。
- `.html` ファイル: horse*{horse_id}*{data_version}.html の形式。
  - 例: horse_2017102294_20251111T091410+0900_sha256=1a2b3c4d.html
  - horse\_ というプレフィックスで始まり、horse_id、バージョン情報が続きます。

##### ped ディレクトリ (血統)

- 対象: 馬の血統に関するデータ
- `.bin` ファイル: horse_id.bin の形式。
  - 例: 2017102294.bin
  - horse ディレクトリと異なり、\_type のようなサフィックスはありません。
- `.html` ファイル: ped*{horse_id}*{data_version}.html の形式。
  - 例: ped_2017102294_20251111T091410+0900_sha256=5e6f7g8h.html
  - ped\_ というプレフィックスで始まり、horse_id、バージョン情報が続きます。

##### race ディレクトリ

- 対象: レース結果に関するデータ
- `.bin` ファイル: race_id.bin の形式。
  - 例: 202001010101.bin
  - 12 桁の race_id がファイル名になっています。
- `.html` ファイル: race*{race_id}*{data_version}.html の形式。
  - 例: race_202305020811_20251114T102824+0900_sha256=c90e86f1.html
  - race\_ というプレフィックスで始まり、race_id、バージョン情報が続きます。

##### shutuba ディレクトリ

- 対象: 出馬表に関するデータ
- `.bin` ファイル: race_id.bin の形式。
  - 例: 202001010101.bin
  - race ディレクトリと同様に、12 桁の race_id がファイル名になっています。
- `.html` ファイル: shutuba*{race_id}*{data_version}.html の形式。
  - 例: shutuba_202305020811_20251111T102915+0900_sha256=0bd7bfca.html
  - shutuba\_ というプレフィックスで始まり、race_id、バージョン情報が続きます。

3. バージョン情報 (data_version)

新しい .html ファイルに付与されている data*version は、{タイムスタンプ}*{ハッシュ値} という構造をしています。
タイムスタンプ: YYYYMMDDTHHMMSS+0900 の形式で、ファイルが取得された日時を示します。
ハッシュ値: sha256={ハッシュ値の一部} の形式で、ファイル内容のハッシュ値（SHA256）の先頭 8 文字です。これにより、ファイル内容が同じであれば同じハッシュ値を持つため、データの重複を避けることができます。
同じ id (horse_id や race_id) に対して複数の .html ファイルが存在することがありますが、これはデータの更新や再取得が行われた結果であり、data_version によってどの時点のデータであるかを正確に識別できます。

まとめ
keibaai/data/raw/html ディレクトリは、システムの改修履歴を反映した、新旧の命名規則とファイル形式が混在したデータ構造となっています。データを扱う際には、これらの命名規則の違いと、.bin と .html の両方の形式を考慮する必要があります。
特に、新しい .html ファイルはバージョン管理されており、より信頼性の高いデータソースと言えます。
