# 11. ダッシュボード (可視化と分析)

## 11.1 概要

KeibaAIは、モデルの予測結果やシミュレーション、投資戦略の収益性を直感的に理解するためのWebダッシュボード（Streamlit製）を提供しています。
このダッシュボードは、専門的な知識がないユーザーでも「AIが何を考えているか」「どの馬がお買い得か」を容易に把握できるように設計されています。

### 起動方法

```bash
streamlit run keibaai/src/dashboard/app.py
```

## 11.2 機能一覧

ダッシュボードは以下の4つの主要ページで構成されています。

### 1. AIの成績表 (Evaluation Report)
モデルの予測精度を日次、競馬場別、距離別に可視化します。

- **主な指標**:
    - **タイム誤差 (RMSE)**: 走破タイムの予測誤差。数値が小さいほど優秀です。
    - **順位予想の正確さ (スピアマン順位相関係数)**: 着順の並びをどれだけ正確に当てられたか。1.0に近いほど完璧です。
    - **的中率 (Hit Rate)**: AIが上位と予想した馬が実際に3着以内に入った割合。

### 2. レース予想とシミュレーション (Simulation Visualizer)
特定のレースにおけるAIの予想詳細を確認できます。

- **機能**:
    - **勝率予想**: 各馬の勝率を棒グラフで表示。
    - **お買い得度分析 (期待値)**: 「勝率 × オッズ」で期待値を計算し、1.0（損益分岐点）を超える「美味しい馬」を可視化します。
    - **もしも分析 (What-If)**: 直前オッズが変動した場合に、期待値がどう変わるかをシミュレーションできます。

### 3. 予想の根拠 (Feature Analysis)
AIが予測を行う際に、どのデータを重視したかを解明します。

- **機能**:
    - **重要度ランキング**: 予測に寄与したデータ（特徴量）をランキング形式で表示。
    - **影響分析 (PDP)**: 特定のデータ（例：馬体重）が増減した際に、AIの評価がどう変わるかをグラフ化。

### 4. 収支分析 (ROI Analysis)
AIの予想に基づいて馬券を購入した場合の収益シミュレーションを行います。

- **機能**:
    - **資産推移**: 期間中の資金の増減グラフ。
    - **安定性 (シャープレシオ)**: リスクに対するリターンの効率。
    - **最大損失率 (ドローダウン)**: 一時的に最大でどれくらい資金が減ったか。

## 11.3 用語集 (初心者向け)

ダッシュボード内では、直感的な理解を助けるために以下の用語置き換えを行っています。

| 専門用語 | ダッシュボード上の表記 | 意味 |
| :--- | :--- | :--- |
| RMSE | タイム誤差 | 予測タイムと実際タイムのズレ。小さいほど良い。 |
| Spearman Correlation | 順位予想の正確さ | 着順の並びの正解率。1.0に近いほど良い。 |
| Feature Importance | 重要度ランキング | AIが重視しているデータの順位。 |
| Expected Value (EV) | 期待値 / お買い得度 | 100円買った時の平均払戻額。100円超ならプラス期待。 |
| Drawdown | 最大損失率 | ピーク時からの一時的な資産減少幅。 |

## 11.4 ディレクトリ構造

```
keibaai/src/dashboard/
├── app.py                      # メインアプリケーション
└── pages/
    ├── 1_Evaluation_Report.py  # 成績表ページ
    ├── 2_Simulation_Visualizer.py # シミュレーションページ
    ├── 3_Feature_Analysis.py   # 特徴量分析ページ
    └── 4_ROI_Analysis.py       # 収支分析ページ
```
