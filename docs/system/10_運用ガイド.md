# 10_é‹ç”¨ã‚¬ã‚¤ãƒ‰

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-11-18

---

## ğŸ“‘ ç›®æ¬¡

1. [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
2. [æ—¥æ¬¡é‹ç”¨ãƒ•ãƒ­ãƒ¼](#æ—¥æ¬¡é‹ç”¨ãƒ•ãƒ­ãƒ¼)
3. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
4. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°)
5. [ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚«ãƒãƒª](#ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚«ãƒãƒª)

---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ç’°å¢ƒæ§‹ç¯‰

#### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/umazkym/KeibaAI_v2.git
cd KeibaAI_v2
```

#### 2. Pythonç’°å¢ƒæ§‹ç¯‰

```bash
# Python 3.10+ æ¨å¥¨
python --version  # 3.10ä»¥ä¸Šã‚’ç¢ºèª

# ä»®æƒ³ç’°å¢ƒä½œæˆ
python -m venv venv

# ä»®æƒ³ç’°å¢ƒæœ‰åŠ¹åŒ–
source venv/bin/activate  # Linux/Mac
# ã¾ãŸã¯
venv\Scripts\activate  # Windows

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt
```

#### 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p keibaai/data/{raw/html/{race,shutuba,horse,ped},parsed/parquet/{races,shutuba,horses,pedigrees},features/parquet,models,simulations,orders,logs,metadata}
```

#### 4. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª

```bash
# YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
ls keibaai/configs/
# default.yaml, scraping.yaml, features.yaml, models.yaml, optimization.yaml
```

---

## ğŸ“… æ—¥æ¬¡é‹ç”¨ãƒ•ãƒ­ãƒ¼

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆCronè¨­å®šä¾‹ï¼‰

```bash
# /etc/crontab ã¾ãŸã¯ crontab -e

# æ·±å¤œ3:00 - å‰æ—¥ãƒ¬ãƒ¼ã‚¹çµæœã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
0 3 * * * cd /path/to/KeibaAI_v2 && /path/to/venv/bin/python run_scraping_pipeline_local.py >> /var/log/keibaai/scraping.log 2>&1

# æ·±å¤œ4:00 - ãƒ‘ãƒ¼ã‚¹å‡¦ç†
0 4 * * * cd /path/to/KeibaAI_v2 && /path/to/venv/bin/python run_parsing_pipeline_local.py >> /var/log/keibaai/parsing.log 2>&1

# æ·±å¤œ4:30 - ç‰¹å¾´é‡ç”Ÿæˆ
30 4 * * * cd /path/to/KeibaAI_v2 && /path/to/venv/bin/python keibaai/src/features/generate_features.py --date $(date -d yesterday +\%Y-\%m-\%d) >> /var/log/keibaai/features.log 2>&1

# æ·±å¤œ5:00 - ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•ï¼‰
0 5 * * * cd /path/to/KeibaAI_v2 && /path/to/venv/bin/python keibaai/scripts/run_quality_checks.py --config keibaai/configs/default.yaml >> /var/log/keibaai/quality_check.log 2>&1

# æœ10:00 - å½“æ—¥ãƒ¬ãƒ¼ã‚¹äºˆæ¸¬
0 10 * * * cd /path/to/KeibaAI_v2 && /path/to/venv/bin/python keibaai/src/models/predict.py --date $(date +\%Y-\%m-\%d) >> /var/log/keibaai/predict.log 2>&1

# æ—¥æ›œå¤œ23:00 - ãƒ¢ãƒ‡ãƒ«å†è¨“ç·´
0 23 * * 0 cd /path/to/KeibaAI_v2 && /path/to/venv/bin/python keibaai/src/models/train_mu_model.py >> /var/log/keibaai/train.log 2>&1

# æœˆæ›œæœ9:00 - é€±æ¬¡ãƒ¢ãƒ‡ãƒ«åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
0 9 * * 1 cd /path/to/KeibaAI_v2 && /path/to/venv/bin/python keibaai/scripts/run_quality_checks.py --model-analysis-only --model-dir keibaai/data/models/latest --predictions keibaai/data/predictions/latest.parquet --actuals keibaai/data/parsed/parquet/races/races.parquet >> /var/log/keibaai/model_analysis.log 2>&1
```

### æ‰‹å‹•å®Ÿè¡Œæ‰‹é †

#### Phase 0: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°

```bash
# å‰æ—¥ã®ãƒ¬ãƒ¼ã‚¹çµæœå–å¾—
python run_scraping_pipeline_local.py

# ã¾ãŸã¯ç‰¹å®šæ—¥ä»˜ã‚’æŒ‡å®š
python keibaai/src/run_scraping_pipeline_local.py --start_date 2023-10-01 --end_date 2023-10-01
```

#### Phase 1: ãƒ‘ãƒ¼ã‚¹

```bash
# å…¨HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒ¼ã‚¹
python run_parsing_pipeline_local.py

# ãƒ‘ãƒ¼ã‚¹çµæœã®ç¢ºèª
python check_parsed_data.py
```

#### Phase 2: ç‰¹å¾´é‡ç”Ÿæˆ

```bash
# ç‰¹å®šæœŸé–“ã®ç‰¹å¾´é‡ç”Ÿæˆ
python keibaai/src/features/generate_features.py \
  --start_date 2023-01-01 \
  --end_date 2023-12-31

# ç‰¹å¾´é‡ã®ç¢ºèª
python check_features_data.py
```

#### Phase 3: ãƒ¢ãƒ‡ãƒ«è¨“ç·´

```bash
# Î¼ãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´
python keibaai/src/models/train_mu_model.py \
  --start_date 2020-01-01 \
  --end_date 2023-09-30 \
  --output_dir data/models/20231001_lgbm

# ãƒ¢ãƒ‡ãƒ«ã®è©•ä¾¡
python keibaai/src/models/evaluate_model.py \
  --model_path data/models/20231001_lgbm/mu_model.txt \
  --test_date_start 2023-10-01 \
  --test_date_end 2023-10-31
```

#### Phase 4: äºˆæ¸¬

```bash
# å½“æ—¥ãƒ¬ãƒ¼ã‚¹ã®äºˆæ¸¬
python keibaai/src/models/predict.py \
  --date 2023-10-01 \
  --model_dir data/models/20231001_lgbm
```

#### Phase 5: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# å½“æ—¥ãƒ¬ãƒ¼ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
python keibaai/src/sim/simulate_daily_races.py \
  --date 2023-10-01 \
  --K 1000
```

#### Phase 6: æœ€é©åŒ–

```bash
# å½“æ—¥ãƒ¬ãƒ¼ã‚¹ã®æœ€é©åŒ–
python keibaai/src/optimizer/optimize_daily_races.py \
  --date 2023-10-01 \
  --W_0 100000
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒé€”ä¸­ã§æ­¢ã¾ã‚‹

**ç—‡çŠ¶**:
```
HTTP 400 Error. IP BANã®å¯èƒ½æ€§
```

**åŸå› **: ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ï¼ˆIP BANï¼‰

**å¯¾å‡¦**:
1. 60ç§’å¾…æ©Ÿï¼ˆè‡ªå‹•ï¼‰
2. ãã‚Œã§ã‚‚ç¶šãå ´åˆã¯24æ™‚é–“å¾…æ©Ÿ
3. VPN/ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§å®Ÿè¡Œ
4. `MIN_SLEEP_SECONDS`ã‚’å¢—ã‚„ã™ï¼ˆ3ç§’ â†’ 5ç§’ï¼‰

### å•é¡Œ2: ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**:
```
Parse error: race_table_01 not found
```

**åŸå› **: HTMLãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒå¤‰æ›´ã•ã‚ŒãŸå¯èƒ½æ€§

**å¯¾å‡¦**:
1. å¯¾è±¡HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
```bash
python debug_race_results.py --file data/raw/html/race/202310010811.bin
```

2. HTMLãƒ‘ãƒ¼ã‚µãƒ¼ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¿½åŠ 

3. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
```sql
SELECT * FROM parse_errors ORDER BY timestamp DESC LIMIT 10;
```

### å•é¡Œ3: ç‰¹å¾´é‡ç”ŸæˆãŒé…ã„

**ç—‡çŠ¶**: 1æ—¥åˆ†ã®ç‰¹å¾´é‡ç”Ÿæˆã«1æ™‚é–“ä»¥ä¸Šã‹ã‹ã‚‹

**å¯¾å‡¦**:
1. ä¸¦åˆ—åŒ–
```python
# generate_features.py ã«è¿½åŠ 
from multiprocessing import Pool

with Pool(processes=4) as pool:
    pool.map(generate_race_features, race_ids)
```

2. å¢—åˆ†æ›´æ–°
```bash
# æ˜¨æ—¥åˆ†ã®ã¿ç”Ÿæˆ
python generate_features.py --date $(date -d yesterday +%Y-%m-%d)
```

### å•é¡Œ4: ãƒ¡ãƒ¢ãƒªä¸è¶³

**ç—‡çŠ¶**:
```
MemoryError: Unable to allocate array
```

**å¯¾å‡¦**:
1. ãƒãƒ£ãƒ³ã‚¯å‡¦ç†
```python
# å¤§ããªDataFrameã‚’åˆ†å‰²å‡¦ç†
for chunk in pd.read_parquet('races.parquet', chunksize=10000):
    process_chunk(chunk)
```

2. ãƒ‡ãƒ¼ã‚¿å‹æœ€é©åŒ–
```python
# float64 â†’ float32
df['finish_time_seconds'] = df['finish_time_seconds'].astype('float32')
```

3. ãƒ¡ãƒ¢ãƒªè§£æ”¾
```python
import gc
gc.collect()
```

### å•é¡Œ5: ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã™ã‚‹

**ç—‡çŠ¶**:
```
[FAIL] parsed_races: races.parquet ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼
```

**åŸå› **: Parquetãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã¾ãŸã¯å­˜åœ¨ã—ãªã„

**å¯¾å‡¦**:
```bash
# 1. è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
ls -lh keibaai/data/parsed/parquet/races/races.parquet

# 2. ç ´æã—ã¦ã„ã‚‹å ´åˆã¯å†ãƒ‘ãƒ¼ã‚¹
python run_parsing_pipeline_local.py

# 3. å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å†å®Ÿè¡Œ
python keibaai/scripts/run_quality_checks.py --validation-only
```

### å•é¡Œ6: ãƒ¢ãƒ‡ãƒ«åˆ†æã§ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**:
```
KeyError: 'predicted_score'
```

**åŸå› **: äºˆæ¸¬çµæœã®Parquetãƒ•ã‚¡ã‚¤ãƒ«ã«å¿…è¦ãªã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ãªã„

**å¯¾å‡¦**:
```bash
# 1. äºˆæ¸¬çµæœã®ã‚¹ã‚­ãƒ¼ãƒç¢ºèª
python -c "import pandas as pd; print(pd.read_parquet('predictions.parquet').columns)"

# 2. äºˆæ¸¬ã‚’å†å®Ÿè¡Œ
python keibaai/src/models/predict.py \
  --date 2023-10-01 \
  --model_dir keibaai/data/models/latest

# 3. ãƒ¢ãƒ‡ãƒ«åˆ†æã‚’å†å®Ÿè¡Œ
python keibaai/scripts/run_quality_checks.py --model-analysis-only \
  --model-dir keibaai/data/models/latest \
  --predictions keibaai/data/predictions/2023-10-01.parquet \
  --actuals keibaai/data/parsed/parquet/races/races.parquet
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### ãƒ­ã‚°ç¢ºèª

```bash
# æœ€æ–°ã®ãƒ­ã‚°ç¢ºèª
tail -f keibaai/data/logs/keibaai_$(date +%Y%m%d).log

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿æŠ½å‡º
grep ERROR keibaai/data/logs/*.log

# è­¦å‘Šãƒ­ã‚°ã®ã¿æŠ½å‡º
grep WARNING keibaai/data/logs/*.log
```

### è‡ªå‹•ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ï¼‰

**åŒ…æ‹¬çš„ãªå“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ**:
```bash
# å…¨ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ + ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼‰
python keibaai/scripts/run_quality_checks.py \
  --config keibaai/configs/default.yaml

# ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
ls keibaai/data/quality_reports/$(date +%Y/%m/%d)/

# å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«:
#   validation_report_YYYYMMDD_HHMMSS.json
#   validation_report_YYYYMMDD_HHMMSS.md
#   monitoring_metrics_YYYYMMDD_HHMMSS.json
#   integrated_report_YYYYMMDD_HHMMSS.md
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿å®Ÿè¡Œ**:
```bash
python keibaai/scripts/run_quality_checks.py --validation-only

# å‡ºåŠ›ä¾‹:
# ===============================================================================
# ãƒ‡ãƒ¼ã‚¿å“è³ªæ¤œè¨¼ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–‹å§‹
# ===============================================================================
#
# [Phase 1] ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
# --------------------------------------------------------------------------------
# [PASS] scraping_race: race ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã¯æ­£å¸¸
# [PASS] scraping_shutuba: shutuba ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã¯æ­£å¸¸
#
# [Phase 2] ãƒ‘ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
# --------------------------------------------------------------------------------
# [PASS] parsed_races: races ã®ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ã¯æ­£å¸¸
# [WARNING] parsed_shutuba: 2 å€‹ã®ã‚«ãƒ©ãƒ ã§é«˜æ¬ æç‡
#
# [Phase 3] ç‰¹å¾´é‡ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
# --------------------------------------------------------------------------------
# [PASS] features_data_leak: ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ãªã—
# [PASS] features_quality: ç‰¹å¾´é‡ã®æ¬ æç‡ã¯æ­£å¸¸
#
# ===============================================================================
# æ¤œè¨¼çµæœã‚µãƒãƒª
# ===============================================================================
# ç·ãƒã‚§ãƒƒã‚¯æ•°: 25
# âœ“ åˆæ ¼: 20
# âš  è­¦å‘Š: 4
# âœ— å¤±æ•—: 1
```

### ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ã®è©³ç´°åˆ†æ

**ãƒ¢ãƒ‡ãƒ«åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ**:
```bash
python keibaai/scripts/run_quality_checks.py --model-analysis-only \
  --model-dir keibaai/data/models/latest \
  --predictions keibaai/data/predictions/2023-10-01.parquet \
  --actuals keibaai/data/parsed/parquet/races/races.parquet

# å‡ºåŠ›ä¾‹:
# ===============================================================================
# ãƒ¢ãƒ‡ãƒ«åˆ†æé–‹å§‹
# ===============================================================================
#
# [1] å…¨ä½“çš„ãªè©•ä¾¡æŒ‡æ¨™ã®è¨ˆç®—
# ã‚¹ãƒ”ã‚¢ãƒãƒ³é †ä½ç›¸é–¢ä¿‚æ•° (å¹³å‡): -0.5234
# Brier Score: 0.1842
# Expected Calibration Error: 0.0803
# Top-1 Accuracy: 0.3214
# Top-3 Accuracy: 0.6801
# Top-5 Accuracy: 0.8512
# ROI (æ¨¡æ“¬æŠ•è³‡): 5.23%
#
# [2] ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥åˆ†æ
#
# ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ: distance
#   sprint: ä»¶æ•°=5000, ç›¸é–¢=-0.4812
#   mile: ä»¶æ•°=7000, ç›¸é–¢=-0.5501
#   intermediate: ä»¶æ•°=6000, ç›¸é–¢=-0.5012
#
# [3] ã‚¨ãƒ©ãƒ¼åˆ†æ
#
# äºˆæ¸¬ã‚¨ãƒ©ãƒ¼ã®å¤§ãã„ãƒ¬ãƒ¼ã‚¹ï¼ˆä¸Šä½5ä»¶ï¼‰:
#   1. race_id=202305040301, ç›¸é–¢=0.1234, è·é›¢=1600m, é¦¬å ´=èŠ
#   2. race_id=202305070812, ç›¸é–¢=0.0890, è·é›¢=2000m, é¦¬å ´=ãƒ€ãƒ¼ãƒˆ
#
# [4] ç‰¹å¾´é‡é‡è¦åº¦åˆ†æ
#
# ç‰¹å¾´é‡é‡è¦åº¦ï¼ˆä¸Šä½10ä»¶ï¼‰:
#   1. avg_finish_last3: 0.1245
#   2. jockey_win_rate: 0.0987
#   3. horse_weight_change: 0.0856
#
# [5] æ”¹å–„ææ¡ˆã®ç”Ÿæˆ
#
# æ”¹å–„ææ¡ˆ:
#   1. âœ“ äºˆæ¸¬ç²¾åº¦ã¯è‰¯å¥½ï¼ˆç›¸é–¢=-0.52ï¼‰ã€‚
#   2. âš  sprint ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§æ€§èƒ½ãŒä½ã„ï¼ˆç›¸é–¢=-0.48ï¼‰ã€‚
#      ã“ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå‘ã‘ã®ç‰¹å¾´é‡è¿½åŠ ã‚„ãƒ‡ãƒ¼ã‚¿æ‹¡å……ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
#   3. âš  Brier Score ãŒé«˜ã„ï¼ˆ0.18ï¼‰ã€‚
#      ç¢ºç‡ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ”¹å–„ãŒå¿…è¦ã§ã™ã€‚Temperature Scalingãªã©ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
#
# ===============================================================================
# ãƒ¢ãƒ‡ãƒ«åˆ†æå®Œäº†
# ===============================================================================
```

### ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª

**Markdownãƒ¬ãƒãƒ¼ãƒˆã‚’äººé–“ãŒèª­ã¿ã‚„ã™ã„å½¢å¼ã§ç¢ºèª**:
```bash
# çµ±åˆãƒ¬ãƒãƒ¼ãƒˆ
cat keibaai/data/quality_reports/$(date +%Y/%m/%d)/integrated_report_*.md

# ãƒ¢ãƒ‡ãƒ«åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
cat keibaai/data/quality_reports/$(date +%Y/%m/%d)/model_analysis_*.md
```

### å¾“æ¥ã®ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆæ—§æ–¹å¼ï¼‰

**ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼**:
```bash
# ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
python check_parsed_data.py

# å‡ºåŠ›ä¾‹:
# races.parquet: 278,098 rows
#   Missing values:
#     trainer_id: 850 (0.3%)
#     owner_name: 1240 (0.4%)
#   Data types: OK
#   Duplicates: 0
# âœ“ All validations passed
```

### ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–

```bash
# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
du -sh keibaai/data/*

# å‡ºåŠ›ä¾‹:
# 15G   keibaai/data/raw
# 2.1G  keibaai/data/parsed
# 1.8G  keibaai/data/features
# 450M  keibaai/data/models
# 120M  keibaai/data/logs

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ï¼ˆè¨“ç·´æ™‚ï¼‰
ps aux | grep python | grep train_mu_model
```

---

## ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚«ãƒãƒª

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡

| ãƒ‡ãƒ¼ã‚¿ | é »åº¦ | é‡è¦åº¦ | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆ |
|-------|------|-------|--------------|
| **ç”ŸHTML** (`data/raw/html/`) | é€±æ¬¡ | é«˜ | å¤–éƒ¨HDD/ã‚¯ãƒ©ã‚¦ãƒ‰ |
| **ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿Parquet** (`data/parsed/`) | æ—¥æ¬¡ | ä¸­ | å¤–éƒ¨HDD |
| **ç‰¹å¾´é‡** (`data/features/`) | é€±æ¬¡ | ä½ï¼ˆå†ç”Ÿæˆå¯èƒ½ï¼‰ | - |
| **ãƒ¢ãƒ‡ãƒ«** (`data/models/`) | ãƒ¢ãƒ‡ãƒ«æ›´æ–°æ™‚ | é«˜ | Git LFS/ã‚¯ãƒ©ã‚¦ãƒ‰ |
| **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«** (`configs/`) | Gitç®¡ç† | é«˜ | GitHub |
| **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿DB** (`metadata/db.sqlite3`) | æ—¥æ¬¡ | ä¸­ | å¤–éƒ¨HDD |

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
#!/bin/bash
# backup_daily.sh

BACKUP_DIR="/mnt/external/keibaai_backup/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# ç”ŸHTMLã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆé€±æ¬¡ï¼‰
if [ $(date +%u) -eq 7 ]; then  # æ—¥æ›œæ—¥
    tar -czf $BACKUP_DIR/raw_html.tar.gz keibaai/data/raw/html/
fi

# ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp -r keibaai/data/parsed/parquet/ $BACKUP_DIR/

# ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿DBã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp keibaai/data/metadata/db.sqlite3 $BACKUP_DIR/

# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šå‰ï¼‰
find /mnt/external/keibaai_backup/ -type d -mtime +30 -exec rm -rf {} \;
```

### ãƒªã‚«ãƒãƒªæ‰‹é †

#### ã‚±ãƒ¼ã‚¹1: ç”ŸHTMLãŒç ´æ

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
tar -xzf /mnt/external/keibaai_backup/20231001/raw_html.tar.gz -C keibaai/data/

# å†ãƒ‘ãƒ¼ã‚¹
python run_parsing_pipeline_local.py
```

#### ã‚±ãƒ¼ã‚¹2: Parquetãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æ

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
cp -r /mnt/external/keibaai_backup/20231001/parsed/ keibaai/data/

# ã¾ãŸã¯ç”ŸHTMLã‹ã‚‰å†ãƒ‘ãƒ¼ã‚¹
python run_parsing_pipeline_local.py
```

#### ã‚±ãƒ¼ã‚¹3: ãƒ¢ãƒ‡ãƒ«ãŒç ´æ

```bash
# Git LFSã‹ã‚‰å¾©å…ƒ
git lfs pull

# ã¾ãŸã¯å†è¨“ç·´
python keibaai/src/models/train_mu_model.py
```

---

## ğŸ¯ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯

```bash
# æ¯é€±æœˆæ›œæ—¥ã«ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯
# crontab -e
0 9 * * 1 cd /path/to/KeibaAI_v2 && python check_parsed_data.py | mail -s "Data Quality Report" admin@example.com
```

### 2. ãƒ¢ãƒ‡ãƒ«ã®å®šæœŸå†è¨“ç·´

- é€±æ¬¡: ç›´è¿‘1é€±é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦å†è¨“ç·´
- æœˆæ¬¡: ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
- å››åŠæœŸ: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¦‹ç›´ã—

### 3. ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# logrotateè¨­å®š
# /etc/logrotate.d/keibaai
/var/log/keibaai/*.log {
    daily
    rotate 30
    compress
    missingok
    notifempty
}
```

### 4. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

```bash
# ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
# crontab -e
*/30 * * * * cd /path/to/KeibaAI_v2 && grep ERROR keibaai/data/logs/keibaai_$(date +\%Y\%m\%d).log | tail -1 | mail -s "KeibaAI Error Alert" admin@example.com
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. [01_ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦.md](./01_ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦.md)
2. [CLAUDE.md](../CLAUDE.md) - AIé–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰
3. [QUALITY_CHECK_GUIDE.md](../QUALITY_CHECK_GUIDE.md) - ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ãƒ»ãƒ¢ãƒ‡ãƒ«åˆ†æã‚¬ã‚¤ãƒ‰ï¼ˆè©³ç´°ç‰ˆï¼‰
4. [schema.md](../schema.md) - ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ
5. [PROGRESS.md](../PROGRESS.md) - ãƒ‡ãƒ¼ã‚¿å“è³ªé€²æ—

### å•é¡Œå ±å‘Š

- **GitHub Issues**: https://github.com/umazkym/KeibaAI_v2/issues
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
  ```markdown
  ## å•é¡Œã®æ¦‚è¦
  [ç°¡æ½”ã«è¨˜è¿°]

  ## å†ç¾æ‰‹é †
  1. ...
  2. ...

  ## æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ
  [...]

  ## å®Ÿéš›ã®å‹•ä½œ
  [...]

  ## ç’°å¢ƒ
  - OS: [Linux/Mac/Windows]
  - Python: [3.10.x]
  - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°: [æ·»ä»˜]
  ```

---

**ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§**:
1. [01_ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦.md](./01_ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦.md)
2. [02_ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md](./02_ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md)
3. [03_ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«.md](./03_ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«.md)
4. [04_ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°è©³ç´°.md](./04_ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°è©³ç´°.md)
5. [05_ãƒ‘ãƒ¼ã‚¹å‡¦ç†è©³ç´°.md](./05_ãƒ‘ãƒ¼ã‚¹å‡¦ç†è©³ç´°.md)
6. [06_ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°.md](./06_ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°.md)
7. [07_æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«.md](./07_æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«.md)
8. [08_ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨æœ€é©åŒ–.md](./08_ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨æœ€é©åŒ–.md)
9. [09_è¨­å®šã¨ãƒ†ã‚¹ãƒˆ.md](./09_è¨­å®šã¨ãƒ†ã‚¹ãƒˆ.md)
10. [10_é‹ç”¨ã‚¬ã‚¤ãƒ‰.md](./10_é‹ç”¨ã‚¬ã‚¤ãƒ‰.md) â† ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«

---

**æœ€çµ‚æ›´æ–°**: 2025-11-18
**ä½œæˆè€…**: KeibaAI_v2 Development Team
**ãƒ©ã‚¤ã‚»ãƒ³ã‚¹**: MIT License (å€‹äººåˆ©ç”¨ã®ã¿)
