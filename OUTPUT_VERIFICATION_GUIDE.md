# ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œçµæœç¢ºèªã‚¬ã‚¤ãƒ‰

## ğŸ¯ ã‚ãªãŸã®å®Ÿè¡Œçµæœã®åˆ†æ

### âœ… **æˆåŠŸã—ãŸé …ç›®**

1. **ãƒ¬ãƒ¼ã‚¹çµæœã®ãƒ‘ãƒ¼ã‚¹**: å®Œç’§ï¼
   ```
   [âœ“] race_results.csv: 311è¡Œ
   distance_m æ¬ æ: 0è¡Œ (0.00%)
   track_surface æ¬ æ: 0è¡Œ (0.00%)
   ```

2. **å‡ºé¦¬è¡¨ã®ãƒ‘ãƒ¼ã‚¹**: å¤§æˆåŠŸï¼
   ```
   [âœ“] shutuba.csv: 311è¡Œ
   horse_id æ¬ æ: 0è¡Œ (0.00%)
   horse_name æ¬ æ: 0è¡Œ (0.00%)
   ```

   **ã“ã‚Œã¯å¤§ããªæ”¹å–„ã§ã™ï¼**ä»¥å‰ã¯50-100%æ¬ æã§ã—ãŸã€‚

---

## âš ï¸ æ®‹ã£ã¦ã„ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•

### å•é¡Œ1: æ—¥ä»˜æŠ½å‡ºã®è­¦å‘Šï¼ˆ24å›è¡¨ç¤ºï¼‰

**ç—‡çŠ¶**:
```
WARNING:root:æ—¥ä»˜æŠ½å‡º (Active Partial): å¹´ãŒæ¬ è½ã—ã¦ã„ã¾ã™ '10æœˆ9æ—¥(æœˆ)'ã€‚å¹´ã‚’åˆ¥é€”æ¢ç´¢ã—ã¾ã™ã€‚
```

**åŸå› **:
- HTMLã«ã€Œå¹´ã€ãŒå«ã¾ã‚Œã¦ã„ãªã„å½¢å¼ï¼ˆ"10æœˆ9æ—¥(æœˆ)"ï¼‰
- shutuba_parser.pyã¯æ­£å¸¸ã«å¹´ã‚’åˆ¥é€”æ¢ç´¢ã—ã¦å‡¦ç†ã—ã¦ã„ã¾ã™

**å½±éŸ¿**:
- âœ… ãƒ‡ãƒ¼ã‚¿ã¯æ­£ã—ããƒ‘ãƒ¼ã‚¹ã•ã‚Œã¦ã„ã¾ã™
- âš ï¸ ãƒ­ã‚°ãŒç…©é›‘ã«ãªã£ã¦ã„ã‚‹ã ã‘ã§ã™

**å¯¾å‡¦æ¸ˆã¿**:
- `logging.warning()` â†’ `logging.debug()` ã«å¤‰æ›´ã—ã¾ã—ãŸ
- æ¬¡å›å®Ÿè¡Œæ™‚ã¯è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“

---

### å•é¡Œ2: é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç—‡çŠ¶**:
```
[!] horse_info_parser.py ã¾ãŸã¯ pedigree_parser.py ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚
```

**ç¢ºèªæ–¹æ³•**:

#### ã‚¹ãƒ†ãƒƒãƒ—1: å®Ÿéš›ã«`shutuba.csv`ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**Windowsã®å ´åˆ**:
```powershell
# PowerShellã§å®Ÿè¡Œ
dir output_20231009\*.csv

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# race_results.csv
# shutuba.csv          â† ã“ã‚ŒãŒå­˜åœ¨ã™ã‚‹ã‹ï¼Ÿ
# shutuba_metadata.csv â† å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‰Šé™¤æ¨å¥¨ï¼‰
```

**æœŸå¾…**: `shutuba.csv` ãŒå­˜åœ¨ã—ã€311è¡Œã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã“ã¨

#### ã‚¹ãƒ†ãƒƒãƒ—2: `shutuba.csv`ã®å†…å®¹ã‚’ç¢ºèª

```powershell
# æœ€åˆã®5è¡Œã‚’è¡¨ç¤º
Get-Content output_20231009\shutuba.csv -Head 5

# æœŸå¾…ã•ã‚Œã‚‹åˆ—:
# race_id, bracket_number, horse_number, horse_id, horse_name,
# sex_age, basis_weight, jockey_id, jockey_name, trainer_id,
# trainer_name, horse_weight, horse_weight_change, morning_odds,
# morning_popularity, blinkers, scratched, race_date
```

**é‡è¦**: `horse_id`ã€`horse_name`ã€`jockey_name` ãªã©ã®åˆ—ãŒæ­£ã—ãå…¥ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—3: é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ã‚’è¨ºæ–­

æ¬¡å›å®Ÿè¡Œæ™‚ã«ã€ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:

```
[!] é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: <å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼>
    Pythonãƒ‘ã‚¹: [...]
    ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: ...
```

**ã‚ˆãã‚ã‚‹åŸå› **:
1. **Pythonãƒ‘ã‚¹ã®å•é¡Œ**:
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆï¼ˆKeibaAI_v2ï¼‰ã§å®Ÿè¡Œã—ã¦ã„ãªã„
   - è§£æ±ºç­–: `cd C:\Users\zk-ht\Keiba\Keiba_AI_v2` ã§ç§»å‹•ã—ã¦ã‹ã‚‰å®Ÿè¡Œ

2. **ä¾å­˜é–¢ä¿‚ã®å•é¡Œ**:
   - ãƒ‘ãƒ¼ã‚µãƒ¼å†…éƒ¨ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„
   - è§£æ±ºç­–: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã€å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

3. **ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„**:
   - ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ï¼ˆé€šå¸¸ã¯ç™ºç”Ÿã—ãªã„ï¼‰
   - è§£æ±ºç­–: `dir keibaai\src\modules\parsers\*.py` ã§ç¢ºèª

---

## ğŸ“‹ æ¬¡å›å®Ÿè¡Œæ™‚ã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

### 1. è­¦å‘ŠãŒæ¶ˆãˆã¦ã„ã‚‹ã‹ç¢ºèª

```bash
python debug_full_pipeline_by_date.py --date 2023-10-09 --output-dir output_20231009_test --parse-only
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:
```
  --- å‡ºé¦¬è¡¨ã®ãƒ‘ãƒ¼ã‚¹ ---
    [1/24] 202305040301 - âœ“ 13é ­  â† WARNING ãŒè¡¨ç¤ºã•ã‚Œãªã„
    [2/24] 202305040302 - âœ“ 13é ­
    ...
```

### 2. é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèª

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**ï¼ˆã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆï¼‰:
```
  --- é¦¬æƒ…å ±ã®ãƒ‘ãƒ¼ã‚¹ ---
  [!] é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: No module named 'xxx'
      Pythonãƒ‘ã‚¹: ['C:\\Users\\zk-ht\\Keiba\\Keiba_AI_v2', ...]
      ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: C:\Users\zk-ht\Keiba\Keiba_AI_v2
```

ã“ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ã€å…·ä½“çš„ãªåŸå› ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚

### 3. å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®å“è³ªã‚’ç¢ºèª

```powershell
# å„CSVã®è¡Œæ•°ã‚’ç¢ºèª
Get-ChildItem output_20231009_test\*.csv | ForEach-Object {
    $lines = (Get-Content $_.FullName | Measure-Object -Line).Lines
    Write-Host "$($_.Name): $lines è¡Œ"
}

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# race_results.csv: 312 è¡Œ (ãƒ˜ãƒƒãƒ€ãƒ¼ + 311ãƒ‡ãƒ¼ã‚¿)
# shutuba.csv: 312 è¡Œ
# horses.csv: 11 è¡Œ (ãƒ˜ãƒƒãƒ€ãƒ¼ + 10ãƒ‡ãƒ¼ã‚¿) â† ãƒ‘ãƒ¼ã‚µãƒ¼ãŒå‹•ä½œã™ã‚Œã°
# horses_performance.csv: ? è¡Œ â† ãƒ‘ãƒ¼ã‚µãƒ¼ãŒå‹•ä½œã™ã‚Œã°
```

---

## ğŸ” è©³ç´°ãªå“è³ªãƒã‚§ãƒƒã‚¯æ–¹æ³•

### shutuba.csvã®å“è³ªç¢ºèª

**Pythonã§ç¢ºèª**:
```python
import pandas as pd

# shutuba.csvã‚’èª­ã¿è¾¼ã¿
df = pd.read_csv('output_20231009/shutuba.csv')

print(f"ç·è¡Œæ•°: {len(df)}")
print(f"ç·ã‚«ãƒ©ãƒ æ•°: {len(df.columns)}")
print("\næ¬ æç‡:")

# é‡è¦ã‚«ãƒ©ãƒ ã®æ¬ æç‡ã‚’ç¢ºèª
important_cols = ['horse_id', 'horse_name', 'jockey_id', 'jockey_name',
                  'trainer_id', 'trainer_name', 'horse_weight']

for col in important_cols:
    if col in df.columns:
        missing_pct = (df[col].isna().sum() / len(df)) * 100
        print(f"  {col}: {missing_pct:.1f}%")
    else:
        print(f"  {col}: ã‚«ãƒ©ãƒ ãªã— âŒ")
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
```
ç·è¡Œæ•°: 311
ç·ã‚«ãƒ©ãƒ æ•°: 18-20

æ¬ æç‡:
  horse_id: 0.0%         â† å®Œç’§ï¼
  horse_name: 0.0%       â† å®Œç’§ï¼
  jockey_id: 0.0%        â† å®Œç’§ï¼
  jockey_name: 0.0%      â† å®Œç’§ï¼
  trainer_id: 0.0%       â† å®Œç’§ï¼
  trainer_name: 0.0%     â† å®Œç’§ï¼
  horse_weight: 5-10%    â† è¨±å®¹ç¯„å›²ï¼ˆè¨ˆæ¸¬ã—ã¦ã„ãªã„é¦¬ãŒã„ã‚‹ï¼‰
```

---

## ğŸ†š ä»¥å‰ã¨ã®æ¯”è¼ƒ

### shutuba_metadata.csvï¼ˆä¿®æ­£å‰ï¼‰ vs shutuba.csvï¼ˆä¿®æ­£å¾Œï¼‰

| é …ç›® | ä¿®æ­£å‰ (metadata) | ä¿®æ­£å¾Œ (shutuba.csv) |
|------|------------------|---------------------|
| **horse_id** | âŒ ã‚«ãƒ©ãƒ ãªã— | âœ… 0%æ¬ æ |
| **horse_name** | âŒ ã‚«ãƒ©ãƒ ãªã— | âœ… 0%æ¬ æ |
| **jockey_id** | âŒ ã‚«ãƒ©ãƒ ãªã— | âœ… 0%æ¬ æ |
| **jockey_name** | âŒ ã‚«ãƒ©ãƒ ãªã— | âœ… 0%æ¬ æ |
| **post_time** | âŒ 100%æ¬ æ | âœ… ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š |
| **race_name** | âŒ 100%æ¬ æ | âœ… ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š |
| **venue** | âŒ 100%æ¬ æ | âœ… ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š |

**çµè«–**: shutuba_parser.pyã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€åœ§å€’çš„ã«æ”¹å–„ã•ã‚Œã¾ã—ãŸï¼

---

## ğŸ’¡ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ä»Šã™ãå®Ÿè¡Œã™ã¹ãã“ã¨

1. **shutuba.csvã®å­˜åœ¨ã¨å†…å®¹ã‚’ç¢ºèª**:
   ```powershell
   # ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹
   Test-Path output_20231009\shutuba.csv

   # å†…å®¹ã®å…ˆé ­ã‚’ç¢ºèª
   Get-Content output_20231009\shutuba.csv -Head 3
   ```

2. **å¤ã„shutuba_metadata.csvã‚’å‰Šé™¤** (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):
   ```powershell
   Remove-Item output_20231009\shutuba_metadata.csv
   ```

3. **æ¬¡å›å®Ÿè¡Œã§è­¦å‘ŠãŒæ¶ˆãˆã¦ã„ã‚‹ã‹ç¢ºèª**:
   ```bash
   python debug_full_pipeline_by_date.py --date 2023-10-09 --output-dir output_test --parse-only
   ```

### é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ã®å•é¡Œè§£æ±º

æ¬¡å›å®Ÿè¡Œæ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã€ä»¥ä¸‹ã‚’è©¦ã—ã¦ãã ã•ã„ï¼š

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ**:
   ```powershell
   cd C:\Users\zk-ht\Keiba\Keiba_AI_v2
   python debug_full_pipeline_by_date.py --date 2023-10-09 --parse-only
   ```

2. **Pythonãƒ‘ã‚¹ã‚’æ˜ç¤ºçš„ã«è¨­å®š** (å¿…è¦ã«å¿œã˜ã¦):
   ```powershell
   $env:PYTHONPATH = "C:\Users\zk-ht\Keiba\Keiba_AI_v2"
   python debug_full_pipeline_by_date.py --date 2023-10-09 --parse-only
   ```

3. **è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª**:
   æ¬¡å›å®Ÿè¡Œæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…ƒã«å¯¾å‡¦ã—ã¾ã™ã€‚

---

## âœ… æœ€çµ‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å®Ÿè¡Œçµæœã‚’ç¢ºèªã™ã‚‹éš›ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:

- [ ] `race_results.csv` ãŒå­˜åœ¨ã—ã€311è¡Œã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹
- [ ] `race_results.csv` ã® distance_m, track_surface ãŒ0%æ¬ æ
- [ ] `shutuba.csv` ãŒå­˜åœ¨ã—ã€311è¡Œã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ (shutuba_metadata.csvã§ã¯ãªã„)
- [ ] `shutuba.csv` ã® horse_id, horse_name ãŒ0%æ¬ æ
- [ ] æ—¥ä»˜æŠ½å‡ºã®è­¦å‘Šï¼ˆWARNINGï¼‰ãŒè¡¨ç¤ºã•ã‚Œãªã„
- [ ] é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè©³ç´°ã«ãªã£ã¦ã„ã‚‹

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

### å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆ

ä»¥ä¸‹ã®æƒ…å ±ã‚’æä¾›ã—ã¦ãã ã•ã„ï¼š

1. **å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆ**:
   ```powershell
   dir output_20231009
   ```

2. **shutuba.csvã®å…ˆé ­3è¡Œ**:
   ```powershell
   Get-Content output_20231009\shutuba.csv -Head 3
   ```

3. **é¦¬æƒ…å ±ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (æ¬¡å›å®Ÿè¡Œæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹è©³ç´°ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)

4. **Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**:
   ```powershell
   python --version
   pwd
   ```

ã“ã‚Œã‚‰ã®æƒ…å ±ãŒã‚ã‚Œã°ã€ã‚ˆã‚Šå…·ä½“çš„ãªã‚µãƒãƒ¼ãƒˆãŒå¯èƒ½ã§ã™ï¼
